<!DOCTYPE html>
<html>
<head>
  <title>Comentarios</title>
</head>
<body>

<h2>Comentar</h2>

<textarea id="comentario"></textarea><br>
<button id="btnComentar">Publicar</button>

<div id="lista"></div>

<script type="module">
import { auth, db } from "./js/firebase.js";
import { onAuthStateChanged } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { addDoc, collection, getDocs } from 
"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

onAuthStateChanged(auth, (user) => {
  if (!user) location.href = "login.html";
});

btnComentar.addEventListener("click", async () => {
  await addDoc(collection(db, "comentarios"), {
    texto: comentario.value,
    fecha: new Date()
  });
  comentario.value = "";
  cargar();
});

async function cargar() {
  lista.innerHTML = "";
  const data = await getDocs(collection(db, "comentarios"));
  data.forEach(d => {
    lista.innerHTML += `<p>${d.data().texto}</p>`;
  });
}

cargar();
</script>

</body>
</html>